<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CYBER-VIBE PROMPT GENERATOR</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --neon-cyan: #00ffff; --neon-magenta: #ff00ff; --bg-dark: #050505; }
        body { background-color: var(--bg-dark); color: var(--neon-cyan); font-family: 'JetBrains Mono', 'Courier New', monospace; padding-bottom: 50px; overflow-x: hidden; }
        .cyber-border { border: 1px solid var(--neon-cyan); box-shadow: 0 0 8px rgba(0, 255, 255, 0.2); }
        .cyber-border-magenta { border: 1px solid var(--neon-magenta); box-shadow: 0 0 8px rgba(255, 0, 255, 0.2); }
        .cyber-border-yellow { border: 1px solid #eab308; box-shadow: 0 0 8px rgba(234, 179, 8, 0.2); }
        .cyber-btn { border: 1px solid var(--neon-cyan); background: transparent; color: var(--neon-cyan); transition: 0.3s; cursor: pointer; }
        .cyber-btn:hover { background: var(--neon-cyan); color: #000; box-shadow: 0 0 15px var(--neon-cyan); }
        .cyber-btn-magenta { border: 1px solid var(--neon-magenta); color: var(--neon-magenta); cursor: pointer; transition: 0.3s;}
        .cyber-btn-magenta:hover { background: var(--neon-magenta); color: #fff; box-shadow: 0 0 15px var(--neon-magenta); }
        .cyber-btn-yellow { border: 1px solid #eab308; color: #eab308; cursor: pointer; transition: 0.3s;}
        .cyber-btn-yellow:hover { background: #eab308; color: #000; box-shadow: 0 0 15px #eab308; }
        .cyber-input { background: #111; border: 1px solid #333; color: #fff; }
        .cyber-input:focus { outline: none; border-color: var(--neon-magenta); }
        .module-card { background: rgba(0,20,20,0.5); transition: transform 0.2s; }
        .module-badge { background: var(--neon-magenta); color: #000; font-weight: bold; padding: 2px 8px; font-size: 10px; border-radius: 4px; }
        
        /* Tabs Style */
        .tab-btn { padding: 12px 24px; font-weight: bold; border: 1px solid #333; color: #666; cursor: pointer; transition: 0.3s; border-bottom: none; border-radius: 8px 8px 0 0; }
        .tab-btn.active { color: var(--neon-cyan); border-color: var(--neon-cyan); background: rgba(0, 255, 255, 0.05); box-shadow: 0 -5px 15px rgba(0,255,255,0.1); }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Custom Radio */
        .cyber-radio { appearance: none; width: 16px; height: 16px; border: 2px solid var(--neon-cyan); border-radius: 50%; background: transparent; cursor: pointer; position: relative; top: 3px; margin-right: 8px;}
        .cyber-radio:checked { background: var(--neon-magenta); border-color: var(--neon-magenta); box-shadow: 0 0 10px var(--neon-magenta); }

        select { appearance: none; background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2300ffff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e"); background-repeat: no-repeat; background-position: right 1rem center; background-size: 1em; }
    </style>
</head>
<body class="max-w-6xl mx-auto p-6">
	<div class="absolute top-6 right-6 z-50">
        <a href="index.html" class="text-xs font-bold text-cyan-400 border border-cyan-400 px-3 py-1 rounded hover:bg-cyan-400 hover:text-black transition-colors duration-300" style="box-shadow: 0 0 5px rgba(0, 255, 255, 0.3);">
            üåê ‰∏≠ÊñáÁâà
        </a>
    </div>
    <header class="mb-6 text-center pb-4">
        <h1 class="text-4xl font-black italic tracking-widest mb-2" style="text-shadow: 2px 2px var(--neon-magenta);">CYBER-VIBE PROMPT GENERATOR</h1>
        <div id="statusIndicator" class="text-xs text-yellow-500 animate-pulse">SYSTEM_BOOTING: Connecting to database...</div>
    </header>

	<div class="flex justify-center border-b border-gray-800 mb-8 space-x-2">
		<button class="tab-btn" onclick="switchTab('tab-env')">üîß Environment Setup</button>
        <button class="tab-btn active" onclick="switchTab('tab-generator')">üßô‚Äç‚ôÇÔ∏è Prompt Compiler</button>
        <button class="tab-btn" onclick="switchTab('tab-docs')">üìö Docs & Explorer</button>   
    </div>

    <div id="tab-generator" class="tab-content active">
        
        <div class="mb-8 p-6 cyber-border-magenta bg-black relative">
            <h2 class="text-xl font-bold mb-4 text-magenta-500 flex items-center">üîç SMART GLOBAL SEARCH</h2>
            <input type="text" id="globalSearch" class="w-full p-4 cyber-input text-lg text-cyan-300 mb-2" placeholder="Enter keywords (e.g., filter, loop, OpenCV)..." onkeyup="performSearch()">
            <div id="searchResults" class="grid grid-cols-1 md:grid-cols-2 gap-2 max-h-48 overflow-y-auto"></div>
        </div>
		
        <div class="mb-8 p-6 cyber-border-yellow bg-black relative">
            <h2 class="text-xl font-bold mb-4 text-yellow-500 flex items-center">
                <span class="mr-2">‚ö°</span> Quick Combo Presets
            </h2>
            <p class="text-sm text-gray-400 mb-4">Select a common workflow to generate a complete prompt instantly!</p>
            <div class="flex flex-col md:flex-row gap-4">
                <select id="comboSelect" class="flex-grow p-3 cyber-input text-sm text-yellow-300">
                    <option value="">-- Select a Combo Preset --</option>
                    <option value="Please read the CSV file at [File Path] and generate an interactive GUI. Allow me to select different columns and plot the selected data as a line chart.">[Interactive Line Chart UI] Read CSV & plot selected columns</option>
                    <option value="Please access the system webcam to display a MediaPipe stickman skeleton. Provide a menu to select specific joints and display their X, Y coordinates. Also, allow me to click on the screen to get the pixel XY coordinates.">[AI Skeleton & Coordinates] Webcam stickman + click coordinates</option>
                    <option value="Please scrape all data from elements with the class [Class Name] on the website [URL], compile the data, and save it as a CSV file.">[Web Scraper] Scrape specific Class data and save as CSV</option>
                    <option value="Please read the signal data at [File Path]. Design a Butterworth low-pass filter (cutoff frequency [X] Hz) to remove noise. Plot the 'original signal' and 'filtered signal' superimposed on the same line chart for comparison.">[Filter & Compare] Low-pass filter & superimposed plot</option>
                    <option value="Please read the video at [File Path], extract the clip from [X] seconds to [Y] seconds, slow the playback speed down to 0.5x, and save it as a new MP4 file.">[Video Edit & Speed] Extract clip & export slow-mo MP4</option>
                    <option value="Please read the dataset at [File Path] and use the [Target Column] as the label. Train a Random Forest classifier, and plot both the Confusion Matrix and a Feature Importance bar chart.">[Machine Learning] Train Random Forest & plot Confusion Matrix</option>
                    <option value="Please automatically read all CSV files in the directory [Folder Path]. Use a loop to calculate the mean and max values of the [Target Column] for each file, merge the results, and export them as a summary Excel file.">[Batch Process & Merge] Read folder CSVs & export summary Excel</option>
                    <option value="Please read the audio file at [File Path], calculate its RMS energy curve to find the timestamp with the highest volume, and plot a Spectrogram to visualize frequency and intensity changes.">[Audio Energy & Spectrum] Calculate RMS & plot Spectrogram</option>
                    <option value="Please read the experimental data at [File Path]. Perform an Independent Samples T-Test on the [Value Column] between [Group A] and [Group B]. Output the P-value and plot a Boxplot that includes outliers.">[Stats & Boxplot] Independent T-Test & Boxplot</option>
                    <option value="Please create a window using Pygame. When the [Signal Variable] exceeds the [Threshold], make the circular character on the screen jump, play a scoring sound effect, and display the current total score.">[Biofeedback Game] Pygame jump & sound on threshold</option>
                </select>
                <button onclick="applyCombo()" class="cyber-btn-yellow px-8 py-3 font-bold whitespace-nowrap">Apply Combo</button>
            </div>
        </div>

        <div class="mb-8 p-6 cyber-border">
            <h2 class="text-xl font-bold mb-4 text-magenta-500">STEP 1: Choose AI Persona Prefix</h2>
            <select id="prefixSelect" class="w-full p-3 cyber-input text-cyan-400">
                <option value="You are a Senior Python Engineer. Please complete the following requests and add detailed comments:">[Senior Architect] Robust modular code</option>
                <option value="Act as an expert in sports science and signal processing. Use NumPy, Pandas, and SciPy to process the following data:">[Signal Processing Expert] Data analysis focus</option>
                <option value="I am a Python beginner. Please write the code and explain how it works line by line in plain English:">[Beginner Mode] Simple explanations & test examples</option>
            </select>
        </div>

        <div class="mb-4 flex justify-between items-end">
            <h2 class="text-xl font-bold text-magenta-500">STEP 2: Stack Prompt Modules</h2>
            <button onclick="addModule()" class="cyber-btn px-4 py-2 text-sm font-bold">+ Add Blank Module</button>
        </div>
        
        <div id="modulesContainer" class="space-y-4 mb-8"></div>

        <div class="p-6 cyber-border bg-black">
            <h2 class="text-xl font-bold mb-4 text-magenta-500">STEP 3: Modification Strategy & Compile</h2>
            
            <div class="mb-6 p-5 border border-gray-700 bg-gray-900 rounded">
                <h3 class="text-yellow-400 font-bold mb-4 text-sm">üõ†Ô∏è Modification Strategy</h3>
                <div class="space-y-3 text-sm text-gray-300">
                    <label class="flex items-center cursor-pointer"><input type="radio" name="modStrategy" value="default" class="cyber-radio" checked onchange="toggleCustomInput()"><span>üÜï New Project (Generate from scratch)</span></label>
                    <label class="flex items-center cursor-pointer"><input type="radio" name="modStrategy" value="small" class="cyber-radio" onchange="toggleCustomInput()"><span>üü¢ Small Mod (Provide only modified snippets & locations)</span></label>
                    <label class="flex items-center cursor-pointer"><input type="radio" name="modStrategy" value="large" class="cyber-radio" onchange="toggleCustomInput()"><span>üî¥ Full Rebuild (Provide complete rewritten code)</span></label>
                    <label class="flex items-center cursor-pointer"><input type="radio" name="modStrategy" value="attached" class="cyber-radio" onchange="toggleCustomInput()"><span>üìé Modify Attached (Tweak based on uploaded file)</span></label>
                    <label class="flex items-center cursor-pointer"><input type="radio" name="modStrategy" value="custom" class="cyber-radio" onchange="toggleCustomInput()"><span>‚úçÔ∏è Custom Rule (e.g., Put #02 inside #01)</span></label>
                </div>
                <textarea id="customStrategyInput" class="hidden w-full mt-4 p-3 cyber-input text-sm text-yellow-300" rows="3" placeholder="Enter custom prompt instructions here..."></textarea>
            </div>

            <button onclick="generateFinalPrompt()" class="cyber-btn-magenta w-full py-3 font-bold text-lg mb-4">>>> GENERATE PROMPT <<<</button>
            <textarea id="finalOutput" class="w-full h-64 p-4 cyber-input text-green-400 font-mono text-sm leading-relaxed mb-4"></textarea>
            <button onclick="copyFinal()" class="cyber-btn w-full py-3 font-bold">COPY TO CLIPBOARD</button>
        </div>
    </div>

    <div id="tab-docs" class="tab-content">
        <div class="mb-8 p-6 cyber-border-yellow bg-black">
            <h2 class="text-xl font-bold mb-2 text-yellow-500">üì° Python Library Explorer</h2>
            <div class="flex flex-col md:flex-row gap-4 mt-4">
                <input type="text" id="explorer-module-name" class="flex-grow p-3 cyber-input text-yellow-300" placeholder="Package name (e.g., scipy.signal)" value="scipy.signal">
                <button onclick="downloadExplorerPy()" class="cyber-btn-yellow px-8 py-3 font-bold">‚¨áÔ∏è Download Script</button>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div class="p-6 cyber-border bg-black">
                <h3 class="font-bold text-magenta-500 mb-2">SciPy</h3>
                <input type="text" id="search-scipy" class="w-full p-2 cyber-input mb-4" placeholder="e.g., filtfilt">
                <button onclick="searchDocs('scipy', 'docs.scipy.org/doc/scipy/reference/')" class="cyber-btn w-full py-2">üîç Search</button>
            </div>
            <div class="p-6 cyber-border bg-black">
                <h3 class="font-bold text-magenta-500 mb-2">Pandas</h3>
                <input type="text" id="search-pandas" class="w-full p-2 cyber-input mb-4" placeholder="e.g., read_csv">
                <button onclick="searchDocs('pandas', 'pandas.pydata.org/docs/reference/')" class="cyber-btn w-full py-2">üîç Search</button>
            </div>
            <div class="p-6 cyber-border bg-black">
                <h3 class="font-bold text-magenta-500 mb-2">OpenCV</h3>
                <input type="text" id="search-opencv" class="w-full p-2 cyber-input mb-4" placeholder="e.g., cvtColor">
                <button onclick="searchDocs('opencv', 'docs.opencv.org/4.x/')" class="cyber-btn w-full py-2">üîç Search</button>
            </div>
            <div class="p-6 cyber-border bg-black">
                <h3 class="font-bold text-magenta-500 mb-2">Scikit-Learn</h3>
                <input type="text" id="search-sklearn" class="w-full p-2 cyber-input mb-4" placeholder="e.g., RandomForest">
                <button onclick="searchDocs('sklearn', 'scikit-learn.org/stable/modules/')" class="cyber-btn w-full py-2">üîç Search</button>
            </div>
            <div class="p-6 cyber-border bg-black">
                <h3 class="font-bold text-magenta-500 mb-2">Plotly</h3>
                <input type="text" id="search-plotly" class="w-full p-2 cyber-input mb-4" placeholder="e.g., px.scatter">
                <button onclick="searchDocs('plotly', 'plotly.com/python/')" class="cyber-btn w-full py-2">üîç Search</button>
            </div>
            <div class="p-6 cyber-border bg-black">
                <h3 class="font-bold text-magenta-500 mb-2">Flet (UI)</h3>
                <input type="text" id="search-flet" class="w-full p-2 cyber-input mb-4" placeholder="e.g., ElevatedButton">
                <button onclick="searchDocs('flet', 'flet.dev/docs/controls/')" class="cyber-btn w-full py-2">üîç Search</button>
            </div>
            <div class="p-6 cyber-border bg-black">
                <h3 class="font-bold text-magenta-500 mb-2">Pygame</h3>
                <input type="text" id="search-pygame" class="w-full p-2 cyber-input mb-4" placeholder="e.g., display.set_mode">
                <button onclick="searchDocs('pygame', 'pygame.org/docs/')" class="cyber-btn w-full py-2">üîç Search</button>
            </div>
            <div class="p-6 cyber-border bg-gray-900 md:col-span-2 lg:col-span-2">
                <h3 class="font-bold text-cyan-500 mb-2">Stack Overflow</h3>
                <input type="text" id="search-general" class="w-full p-2 cyber-input mb-4" placeholder="Paste unknown error messages here...">
                <button onclick="searchDocs('general', 'stackoverflow.com')" class="cyber-btn-magenta w-full py-2">üåê Search Solutions</button>
            </div>
        </div>
    </div>

    <div id="tab-env" class="tab-content">
        <div class="mb-8 text-center">
            <h2 class="text-3xl font-bold text-cyan-400 mb-2">ENVIRONMENT SETUP</h2>
            <p class="text-gray-400">Beginner Zone: Install Miniconda and set up your dev environment.</p>
        </div>

        <div class="mb-8 p-6 cyber-border-magenta bg-black">
            <h2 class="text-xl font-bold mb-2 text-magenta-500 flex items-center">
                <span class="mr-2">üìÑ</span> Step 0: Edit & Download Env File (vibe_sport.yml)
            </h2>
            <p class="text-sm text-gray-400 mb-4">You can modify, add, or remove packages in the text box below. Click download when ready.</p>
            <div class="flex justify-center">
                <button onclick="downloadEnvYml()" class="cyber-btn-magenta px-8 py-3 font-bold tracking-wider w-full">‚¨áÔ∏è Generate & Download vibe_sport.yml</button>
            </div>
            <textarea id="ymlEditor" class="mt-4 p-4 bg-gray-900 border border-gray-700 rounded text-xs text-green-400 font-mono w-full h-48 focus:outline-none focus:border-cyan-500" spellcheck="false">
name: vibe_sport
channels:
  - conda-forge
  - defaults
dependencies:
  - python=3.10
  - spyder
  - spyder-kernels
  - numpy
  - pandas
  - scipy
  - matplotlib
  - seaborn
  - scikit-learn
  - openpyxl
  - pip
  - pip:
      - plotly
      - pingouin
      - moviepy
      - opencv-python
      - mediapipe
      - customtkinter
      - pyinstaller
      - pyserial
      - bleak
      - playwright
      - beautifulsoup4
      - librosa
      - tqdm</textarea>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div class="p-6 cyber-border bg-black">
                <h3 class="font-bold text-lg text-cyan-400 mb-2">STEP 1: Download Miniconda</h3>
                <p class="text-gray-400 text-sm">Go to the official website and download the Miniconda installer for your OS (Python 3.10+ recommended).</p>
                <a href="https://docs.anaconda.com/miniconda/" target="_blank" class="block mt-4 text-center border border-cyan-500 text-cyan-500 hover:bg-cyan-500 hover:text-black py-2 transition text-sm">üîó Miniconda Official Site</a>
            </div>
            
            <div class="p-6 cyber-border bg-black">
                <h3 class="font-bold text-lg text-cyan-400 mb-2">STEP 2: Install Miniconda</h3>
                <p class="text-gray-400 text-sm">Run the installer. Recommended settings:<br>1. Choose <b>Just Me</b>.<br>2. Keep default path.<br>3. <b>DO NOT check</b> Add to PATH.<br>4. Check Register Miniconda as my default Python.</p>
            </div>

            <div class="p-6 cyber-border bg-black">
                <h3 class="font-bold text-lg text-cyan-400 mb-2">STEP 3: Place Env File</h3>
                <p class="text-gray-400 text-sm">Place the downloaded <code class="text-magenta-400 bg-gray-900 px-1">vibe_sport.yml</code> in your user folder <code class="text-yellow-300 bg-gray-900 px-1">C:\Users\YourName</code>.</p>
            </div>

            <div class="p-6 cyber-border bg-black">
                <h3 class="font-bold text-lg text-cyan-400 mb-2">STEP 4: Open Terminal</h3>
                <p class="text-gray-400 text-sm">Search for and open <code class="text-yellow-300 bg-gray-900 px-1">Anaconda Prompt (Miniconda3)</code> from the Windows start menu.</p>
            </div>

            <div class="p-6 cyber-border bg-black">
                <h3 class="font-bold text-lg text-cyan-400 mb-2">STEP 5: Create & Activate</h3>
                <p class="text-gray-400 text-sm">Enter the following command to create the environment (this will take a while):</p>
                <div class="mt-2 p-2 bg-gray-900 border border-gray-700 text-green-400 font-mono text-xs select-all cursor-pointer">
                    conda env create -f vibe_sport.yml
                </div>
                <p class="text-gray-400 text-sm mt-2">Activate it once finished:</p>
                <div class="mt-1 p-2 bg-gray-900 border border-gray-700 text-green-400 font-mono text-xs select-all cursor-pointer">
                    conda activate vibe_sport
                </div>
            </div>

            <div class="p-6 cyber-border bg-black">
                <h3 class="font-bold text-lg text-cyan-400 mb-2">STEP 6: Launch Spyder</h3>
                <p class="text-gray-400 text-sm">Ensure the terminal shows <span class="text-yellow-300">(vibe_sport)</span>, then type the following to start coding!</p>
                <div class="mt-2 p-3 bg-gray-900 border border-gray-700 text-green-400 font-mono text-sm select-all cursor-pointer">
                    spyder
                </div>
            </div>
        </div>
    </div>

    <script>
        // Please replace with your actual Google Apps Script URL
        const API_URL = "https://script.google.com/macros/s/AKfycbz94YXoKDBo88MwYvW5cCLnib4CVkcUdy9WP4RUJ9zft5VO4jv73DBZou8_ImCZlWX5IQ/exec"; 
        let sheetData = [];
        let categoryMap = {};

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
        }
		
        function downloadEnvYml() {
            const ymlContent = document.getElementById('ymlEditor').value;
            const blob = new Blob([ymlContent], { type: "text/yaml;charset=utf-8" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "vibe_sport.yml";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function toggleCustomInput() {
            const strategy = document.querySelector('input[name="modStrategy"]:checked').value;
            document.getElementById('customStrategyInput').classList.toggle('hidden', strategy !== 'custom');
        }

        async function init() {
            try {
                const response = await fetch(API_URL);
                sheetData = await response.json();
                sheetData.forEach(row => {
                    const cat = row["‰∏ªË¶ÅÂàÜÈ°û"];
                    if (cat) {
                        if (!categoryMap[cat]) categoryMap[cat] = [];
                        categoryMap[cat].push(row);
                    }
                });
                document.getElementById('statusIndicator').innerText = `SYSTEM_ONLINE / Loaded ${sheetData.length} modules`;
                document.getElementById('statusIndicator').className = "text-xs text-green-500";
                addModule();
            } catch (e) {
                document.getElementById('statusIndicator').innerText = "Connection Failed";
            }
        }

        function refreshModuleNumbers() {
            const modules = document.querySelectorAll('.module-card');
            modules.forEach((mod, index) => {
                const num = (index + 1).toString().padStart(2, '0');
                mod.querySelector('.module-id-label').innerText = `#${num}`;
            });
        }

        window.addModule = function() {
            const container = document.getElementById('modulesContainer');
            const moduleId = 'mod_' + Date.now();
            let catOptions = `<option value="">-- Select Category --</option>`;
            for (let cat in categoryMap) catOptions += `<option value="${cat}">${cat}</option>`;

            const moduleHTML = `
                <div id="${moduleId}" class="module-card cyber-border p-4 relative mb-4">
                    <div class="flex justify-between items-center mb-3">
                        <span class="module-badge">MODULE <span class="module-id-label">#00</span></span>
                        <div class="flex space-x-2">
                            <button onclick="moveUp('${moduleId}')" class="text-cyan-500 px-2 hover:bg-cyan-900 rounded">‚ñ≤</button>
                            <button onclick="moveDown('${moduleId}')" class="text-cyan-500 px-2 hover:bg-cyan-900 rounded">‚ñº</button>
                            <button onclick="deleteModule('${moduleId}')" class="text-red-500 px-2 hover:bg-red-900 rounded">‚úñ</button>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <select class="main-cat w-full p-2 cyber-input text-xs" onchange="updateSubCat('${moduleId}')">${catOptions}</select>
                        <select class="sub-cat w-full p-2 cyber-input text-xs" onchange="updateDetails('${moduleId}')"><option value="">-- Keyword --</option></select>
                    </div>
                    <div class="mt-4 text-xs">
                        <span class="intent-text text-yellow-300 block mb-1">...</span>
                        <code class="func-text text-green-300">...</code>
                    </div>
                    <div class="param-container hidden mt-2 bg-gray-900 p-2 border border-dashed border-magenta-500">
                        <span class="param-hint text-[10px] text-gray-400 block mb-1"></span>
                        <input type="text" class="param-input w-full p-2 cyber-input text-xs text-yellow-300" placeholder="Parameters...">
                    </div>
                    <textarea class="prompt-data hidden"></textarea>
                </div>`;
            container.insertAdjacentHTML('beforeend', moduleHTML);
            refreshModuleNumbers();
            return moduleId;
        };

        window.updateSubCat = function(id) {
            const mod = document.getElementById(id);
            const mainCat = mod.querySelector('.main-cat').value;
            const subSelect = mod.querySelector('.sub-cat');
            subSelect.innerHTML = '<option value="">-- Keyword --</option>';
            if (categoryMap[mainCat]) {
                categoryMap[mainCat].forEach((item, idx) => {
                    subSelect.insertAdjacentHTML('beforeend', `<option value="${idx}">${item["ÈóúÈçµÂ≠ó (Tags)"]}</option>`);
                });
            }
        };

		window.updateDetails = function(id) {
            const mod = document.getElementById(id);
            const mainCat = mod.querySelector('.main-cat').value;
            const subIdx = mod.querySelector('.sub-cat').value;
            if (subIdx === "") return;
            
            const data = categoryMap[mainCat][subIdx];
            
            const targetFunc = data["Â∞çÊáâÂ•ó‰ª∂/ÂáΩÂºè"] || data["Â∞çÊáâ Scipy ÂáΩÂºè"] || "N/A";
            const userIntent = data["Â≠∏ÁîüÈÅáÂà∞ÁöÑÁãÄÊ≥Å (User Intent)"] || "No description";
            const vibePrompt = data["Vibe ÂííË™û (Prompt)"] || "";
            const paramField = data["ÂèÉÊï∏Â°´Á©∫"] || "";

            mod.querySelector('.intent-text').innerText = userIntent.split(" / ").pop();
            mod.querySelector('.func-text').innerText = targetFunc;
            mod.querySelector('.prompt-data').value = vibePrompt;

            const pc = mod.querySelector('.param-container');
            if (paramField && !paramField.includes("ÁÑ°") && !paramField.includes("None")) {
                pc.classList.remove('hidden');
                mod.querySelector('.param-hint').innerText = paramField;
            } else { 
                pc.classList.add('hidden'); 
            }
        };

        window.deleteModule = function(id) { document.getElementById(id).remove(); refreshModuleNumbers(); };
        window.moveUp = function(id) { const el = document.getElementById(id); if (el.previousElementSibling) { el.parentNode.insertBefore(el, el.previousElementSibling); refreshModuleNumbers(); } };
        window.moveDown = function(id) { const el = document.getElementById(id); if (el.nextElementSibling) { el.parentNode.insertBefore(el.nextElementSibling, el); refreshModuleNumbers(); } };

        window.generateFinalPrompt = function() {
            const prefix = document.getElementById('prefixSelect').value;
            const strategy = document.querySelector('input[name="modStrategy"]:checked').value;
            const modules = document.querySelectorAll('.module-card');
            let finalString = prefix + "\n\n";
            let count = 0;

            modules.forEach((mod, index) => {
                const num = (index + 1).toString().padStart(2, '0');
                const prompt = mod.querySelector('.prompt-data').value;
                const paramValue = mod.querySelector('.param-input').value.trim();
                if (prompt) {
                    const isEnd = paramValue.includes("ÁµêÊùü") || paramValue.toLowerCase().includes("end");
                    if (isEnd) {
                        finalString += `[Module #${num}] üõë Scope End:\nUser specified: ${paramValue}. Please precisely close the corresponding indentation level here.\n--------------------\n`;
                    } else {
                        finalString += `[Module #${num}]\n${prompt}${paramValue ? "\n(Parameters: " + paramValue + ")" : ""}\n--------------------\n`;
                    }
                    count++;
                }
            });

            const strictRule = "Strictly maintain original architecture, variable naming, and UI design. Only perform local tweaks; NO unauthorized refactoring.";
            if (strategy === 'small') finalString += `\n[Strategy: Small Mod]\nPlease provide only the modified snippets and line numbers. Guideline: ${strictRule}`;
            else if (strategy === 'large') finalString += `\n[Strategy: Full Rebuild]\nPlease provide complete and correct rewritten code. Guideline: ${strictRule}`;
            else if (strategy === 'attached') finalString += `\n[Strategy: Modify Attached]\nPlease tweak based on my latest uploaded file. Guideline: ${strictRule}`;
            else if (strategy === 'custom') finalString += `\n[Strategy: Custom Rule]\n${document.getElementById('customStrategyInput').value}`;

            if(count > 0 || document.getElementById('comboSelect').value !== "") {
                document.getElementById('finalOutput').value = finalString;
            } else {
                alert("Please add modules or select a Combo!");
            }
        };

        window.applyCombo = function() {
            const comboText = document.getElementById('comboSelect').value;
            if (!comboText) {
                alert("Please select a Combo Preset first!");
                return;
            }
            
            const prefix = document.getElementById('prefixSelect').value;
            const finalString = prefix + 
                "\n\n====================\n[‚ö° Quick Combo Preset]\n" + 
                comboText + 
                "\n\n====================\n[üõ°Ô∏è Architecture Protection]\nStrictly maintain original structure, variable naming, and UI design. Only perform local tweaks, NO unauthorized refactoring.";
            
            document.getElementById('finalOutput').value = finalString;
            document.getElementById('finalOutput').scrollIntoView({ behavior: 'smooth', block: 'center' });
            
            const outputBox = document.getElementById('finalOutput');
            outputBox.style.animation = "flash-border 0.5s 2";
            setTimeout(() => { outputBox.style.animation = ""; }, 1000);
        };

        window.copyFinal = function() {
            const out = document.getElementById('finalOutput');
            out.select();
            document.execCommand('copy');
            alert("Copied successfully!");
        };

        function performSearch() {
            const query = document.getElementById('globalSearch').value.toLowerCase().trim();
            const res = document.getElementById('searchResults');
            res.innerHTML = '';
            if (!query) return;
            let matches = [];
            for (let cat in categoryMap) {
                categoryMap[cat].forEach((item, idx) => {
                    if (JSON.stringify(item).toLowerCase().includes(query)) matches.push({ cat, idx, item });
                });
            }
            matches.slice(0, 8).forEach(m => {
                const btn = document.createElement('button');
                btn.className = "text-left p-2 border border-gray-800 bg-gray-900 hover:border-cyan-400 text-xs";
                btn.innerHTML = `<span class="text-magenta-400 font-bold">${m.item["ÈóúÈçµÂ≠ó (Tags)"]}</span><br><span class="text-gray-500">${m.item["‰∏ªË¶ÅÂàÜÈ°û"]}</span>`;
                btn.onclick = () => {
                    const id = addModule();
                    const mod = document.getElementById(id);
                    mod.querySelector('.main-cat').value = m.cat;
                    updateSubCat(id);
                    mod.querySelector('.sub-cat').value = m.idx;
                    updateDetails(id);
                    res.innerHTML = '';
                    document.getElementById('globalSearch').value = '';
                };
                res.appendChild(btn);
            });
        }

        function downloadExplorerPy() {
            let m = document.getElementById('explorer-module-name').value.trim().toLowerCase();
            const py = `import importlib, inspect, pandas as pd, os\ndef explore(n):\n try:\n  mod=importlib.import_module(n)\n  data=[{"Type": "Func" if inspect.isfunction(o) else "Class", "Name": k, "Doc": (inspect.getdoc(o) or "").split("\\n")[0]} for k,o in inspect.getmembers(mod) if not k.startswith("_")]\n  df=pd.DataFrame(data)\n  fn=f"{n.replace('.','_')}_dict.csv"\n  df.to_csv(fn, encoding="utf-8-sig", index=False)\n  print(f"‚úÖ Saved to: {fn}")\n except Exception as e: print("Module not found or error:", e)\nexplore("${m}")`;
            const blob = new Blob([py], { type: "text/plain" });
            const a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = `explore_${m}.py`;
            a.click();
        }

        function searchDocs(id, url) {
            const q = document.getElementById('search-' + id).value;
            window.open(`https://www.google.com/search?q=site:${url}+${q}`, '_blank');
        }

        init();
    </script>
</body>

</html>
